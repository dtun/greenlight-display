# Greenlight Scraper - Cloudflare Workers Configuration
# Deploys the balance scraper API to Cloudflare's edge network

name = "greenlight-scraper"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Account ID - set via environment or replace placeholder
# account_id = "your-account-id"

# Workers configuration - use workers.dev subdomain by default
workers_dev = true

# Browser Rendering API binding
[browser]
binding = "BROWSER"

# KV Namespaces - IDs populated by cf-setup.sh script
# Production namespace
[[kv_namespaces]]
binding = "KV_CACHE"
id = "4d2d33c7454a4b71967b76e218c782a8"

# Observability - enable logging and metrics
[observability]
enabled = true

# CPU limits removed - requires paid plan
# [limits]
# cpu_ms = 50000

# ============================================
# Environment-specific configurations
# ============================================

# Development environment
[env.development]
name = "greenlight-scraper-dev"
workers_dev = true

[[env.development.kv_namespaces]]
binding = "CACHE"
id = "placeholder-dev-replace-with-actual-id"

[env.development.browser]
binding = "BROWSER"

# Staging environment
[env.staging]
name = "greenlight-scraper-staging"
workers_dev = true
# Uncomment for custom domain:
# route = { pattern = "api-staging.yourdomain.com/*", zone_name = "yourdomain.com" }

[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "placeholder-staging-replace-with-actual-id"

[env.staging.browser]
binding = "BROWSER"

# Production environment
[env.production]
name = "greenlight-scraper-prod"
workers_dev = false
# Uncomment and configure for custom domain:
# route = { pattern = "api.yourdomain.com/*", zone_name = "yourdomain.com" }

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "placeholder-prod-replace-with-actual-id"

[env.production.browser]
binding = "BROWSER"
